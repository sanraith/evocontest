@using evocontest.WebApp.Controllers;
@model evocontest.WebApp.ViewModels.SubmitViewModel
@{
    ViewData["Title"] = "Feltöltés";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var sub = Model.LatestSubmission;
}
@section Head
{
    <link rel="stylesheet" href="~/css/step-progress.css" />
    <script src="~/js/file-upload-progress.js"></script>
    <script src="~/lib/signalr/signalr.js"></script>
}

<h1>Feltöltés</h1>

<br />
<div class="container-fluid">
    <ul class="list-unstyled multi-steps">
        <li id="progressItem-0" class="is-active" style="display: none"></li>
        <li id="progressItem-1">Feltöltés</li>
        <li id="progressItem-2">Fájl vizsgálat</li>
        <li id="progressItem-3">Unit tesztek</li>
        <li id="progressItem-4">Jelentkezés elfogadva</li>
    </ul>
</div>

@if (sub != null)
{
    @using (Html.BeginForm(nameof(UserController.DoDelete), "User", new { submissionId = sub.Id }, FormMethod.Post))
    {
        <p class="card-header">
            Feltöltött dll: @sub.OriginalFileName <br />
            Validációs állapot: @sub.ValidationState @(sub.IsValid.HasValue ? (sub.IsValid.Value ? "kész" : "sikertelen") : "folyamatban") <br />
            @if (sub.IsValid == false)
            {
                <span class="font-weight-bold">@(sub.Error)</span><br />
            }
            <input type="submit" value="Törlés"
                   class="btn btn-warning"
                   onclick="return confirm('Biztos törölni szeretnéd a benevezett DLL-ed?')" />
        </p>
    }
}
else
{
    <div>
        @using (Html.BeginForm(nameof(UserController.DoUpload), "User", FormMethod.Post, new { id = "upload_form", @class = "upload_form", enctype = "multipart/form-data" }))
        {@:
            <input type="file" name="file1"><br />
            <input type="submit" class="btn btn-primary" value="Feltöltés" disabled="disabled" style="display:none;" /><br />
            <progress value="0" max="100" style="width:300px; display:none;"></progress>
            <h3 class="upload_form_status"></h3>
            <p class="upload_form_progress_status"></p>
            <span id="btn-back" style="display:none">@Html.ActionLink("Vissza", nameof(UserController.Submit))</span>
        }
    </div>
}
